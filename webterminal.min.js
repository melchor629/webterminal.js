!function(){"use strict";var $,Plugin,e,n,t,r,i,s,o,a,l,p,c,d,u,h,f,v,m,window,_this;window=this,$=window.$,m="v0.2",d="webterminal",_this={},l=0,a=$(".consola-line")[l-1],n={server:!1,script:void 0,phpscript:"/"},r={TERM_PROGRAM:window.navigator.userAgent,PWD:decodeURI(document.location.pathname.substr(0,document.location.pathname.lastIndexOf("/")+1)),SHELL:decodeURI(document.location.pathname.substr(0,document.location.pathname.lastIndexOf("/")+1))+"webterminal.js",USER:"guest"},o={},f={},e=function(e){return a=s(),$(a).find("span#g").append(e)},u=function(e){return a=s(),$(a).find("span#g").append("<br>"+e)},s=function(){return l=$(".consola .consola-line").length,a=$(".consola-line")[l-1]},h=function(){var e;return a=s(),e=$(a).find("span#g").text().substr(0,$(a).find("span#g").text().length-1),$(a).find("span#g").empty().append(e)},p=function(){return l=$(_this.element).find(".consola-line").length,$(".consola").append('<div class="consola-line"><span id="t"></span><span id="g"></span><span id="l">_</span></div>'),$($(".consola .consola-line")[l]).find("span#t").text("sh-3.2# "+_this.env.PWD+" "+_this.env.USER+"$ "),$(_this.element).scrollTop(1e5)},v=function(e){var t,r,i,s,o;if(n=_this.conf,n.server===!0){if("node.js"===n.script)i="file:"===document.location.protocol?"http://localhost:8080/":"http://"+document.location.hostname+":8080/",i=i+e+"/"+"?USER="+_this.env.USER;else{if("php"!==n.script)throw $.webterminal.idioma.scriptError;i="file:"===document.location.protocol?"http://localhost/server.php?c="+e+"&USER="+_this.env.USER:"http://"+document.location.hostname+n.phpscript+"server.php?c="+e+"&USER="+_this.env.USER}for(r=0,s=0,o=arguments.length;o>s;s++)t=arguments[s],0!==s&&(i+="&"+(s-1)+"="+encodeURI(arguments[s]),r++);return i+="&PWD="+encodeURI(_this.env.PWD+"&argc="+r)}},t=function(e){var n,t;return-1!==e.indexOf("..")?(t=_this.env.PWD.split("/"),n="",$.each(t,function(e,r){return e<t.length-2?n+=r+"/":void 0}),-1!==e.indexOf("../")&&(n=e.replace("../",n))):"."===e||"./"===e?(n=_this.env.PWD,-1!==e.indexOf("./")&&(n=e.replace("./",n))):n=e,n},i=function(e,n,t){return u(""+e+": "+n+": "+t),p()},(c=function(){return 0===$("span#l").length&&$("body").append('<span id="l" style="display:none"></span>'),$("span#l").delay(600).animate({opacity:0},10).delay(600).animate({opacity:1},10,c)})(),f.cat=function(e){var n,r;return void 0!==e[1]&&void 0===e[2]?(n=encodeURI(t(e[1])),r=v("cat",n),r?$.getJSON(r,function(n){return 1!==n.respuesta.res?(u('<div style="text-align:left;">'+n.respuesta.mensaje+"</div>"),p()):i("cat",e[1],n.respuesta.mensaje)}).error(function(){throw"Server script doesn't exist."}):p()):void 0===e[1]||void 0===e[2]?(u("usage: cat file"),p()):e[1].indexOf(!1)?"-n"===e[1]?(n=encodeURI(t(e[2])),r=v("cat",n),$.getJSON(r,function(n){var t,r;return 1!==n.respuesta.res?(r=n.respuesta.mensaje.split("<br>"),t="",$.each(r,function(e,n){return 9>e?t=t+"&nbsp;&nbsp;&nbsp;&nbsp;"+(e+1)+" "+n+"<br>":99>e?t=t+"&nbsp;&nbsp;&nbsp;"+(e+1)+" "+n+"<br>":999>e?t=t+"&nbsp;&nbsp;"+(e+1)+" "+n+"<br>":9999>e?t=t+"&nbsp;"+(e+1)+" "+n+"<br>":void 0}),u('<div style="text-align:left;">'+t+"</div>"),p()):i("cat",e[2],n.respuesta.mensaje)}).error(function(){throw"Server script doesn't exist."})):"-b"===e[1]?(n=encodeURI(t(e[2])),r=v("cat",n),$.getJSON(r,function(n){var t,r,s,o;if(1!==n.respuesta.res){for(o=n.respuesta.mensaje.split("<br>"),s="",t=0,r=0,r=0;r<o.length;r++){var a=o[r];""!=a?(9>t?s=s+"&nbsp;&nbsp;&nbsp;&nbsp;"+(t+1)+" "+a+"<br>":99>t?s=s+"&nbsp;&nbsp;&nbsp;"+(t+1)+" "+a+"<br>":999>t?s=s+"&nbsp;&nbsp;"+(t+1)+" "+a+"<br>":9999>t&&(s=s+"&nbsp;"+(t+1)+" "+a+"<br>"),t++):s+="<br>"}return u('<div style="text-align:left;">'+s+"</div>"),p()}return i("cat",e[1],n.respuesta.mensaje)}).error(function(){throw"Server script doesn't exist."})):void 0:(u("usage: cat [-n] file"),p())},f.cd=function(e){var n,r;return void 0!==e[1]?(n=t(e[1]),r=v("cd",n),r?$.getJSON(r,function(n){return 1===n.respuesta.res?i("cd",e[1],n.respuesta.mensaje):(_this.env.PWD=n.respuesta.mensaje,p())}).error(function(){throw"Server script doesn't exist."}):p()):p()},f.cwd=function(){return u(_this.env.PWD),p()},f.echo=function(e){var n;return n="",$.each(e,function(e,t){return 0!==e?n+=" "+t:void 0}),u(n),p()},f.env=function(){return $.each(_this.env,function(e,n){return u(e+"="+n)}),p()},f["export"]=function(e){var n;return void 0!==e[1]?(n=e[1].split("="),_this.env[n[0]]=n[1],u(n[0]+" = "+n[1])):u("usage: export VARIABLE=VALUE"),p()},f.help=function(e){var n;return void 0===e[1]?(u("webterminal, version "+m+" ("+window.navigator.userAgent+")"),u($.webterminal.idioma.shell.help[1]),u($.webterminal.idioma.shell.help[2]),u($.webterminal.idioma.shell.help[3]),$.each(_this.lang.help,function(e,n){for(;e.length<7;)e+=" ";return console.log(e.replace(/\ /g,"&nbsp;")),u("&nbsp;&nbsp;"+e.replace(/\ /g,"&nbsp;")+" "+n[0])})):e[1]&&void 0!==_this.help[e[1]]?(n=_this.help[e[1]],u(e[1]+": "+n[0]),n[1]&&u(n[1])):e[1]&&void 0!==_this.lang.help[e[1]]?(n=_this.lang.help[e[1]],u(e[1]+": "+n[0]),n[1]&&u(n[1].replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"))):void 0===_this.help[e[1]]&&void 0===_this.lang.help[e[1]]&&u($.webterminal.idioma.shell.help.noHelp+" `"+e[1]+"`."),p()},f.login=function(e){var n;return void 0===e[1]?(u("No user/password given"),u("Usage: login USER [PASSWORD]"),p()):(n=v("login",e[1])+"&password="+(void 0!==e[2]?MD5(e[2]):"null"))?$.getJSON(n,function(e){return 1===e.respuesta.res?u(e.respuesta.mensaje):_this.env.USER=e.respuesta.mensaje,p()}):void 0},f.ls=function(e){var n;return n=v("ls",_this.env.PWD),n?$.getJSON(n,function(n){return 0===n.respuesta.res?($.each(n.respuesta.mensaje,function(e,n){return u(n)}),p()):i("ls",e[1],n.respuesta.mensaje)}).error(function(){throw"Server script doesn't exist."}):p()},f.mkdir=function(e){var n,r;return void 0!==e[1]?(n=t(e[1]),r=v("mkdir",e[1]),r?$.getJSON(r,function(n){return 1===n.respuesta.res?i("mkdir",e[1],n.respuesta.mensaje):p()}).error(function(){throw"Server script doesn't exist."}):p()):(u("usage: mkdir directoryName"),p())},f.none=function(e){return""!==e[0]?(u("-bash: "+e[0]+": "+$.webterminal.idioma.shell.none),p()):void 0},f.reload=function(){return $(_this.element).delay(333).animate({opacity:0},1111,function(){return window.location=window.location}),u('Waitâ€¦<span id="l">_</span>')},f.rm=function(e){var n,r;return void 0!==e[1]?(n=t(e[1]),r=v("rm",n),r?$.getJSON(r,function(n){return 1===n.respuesta.res?i("rm",e[1],n.respuesta.mensaje):p()}).error(function(){throw"Server script doesn't exist."}):p()):(u("usage: rm file"),p())},f.rmdir=function(e){var n,r;return void 0!==e[1]?(n=t(e[1]),r=v("rmdir",n),"-r"===e[2]&&(r+="&recursive"),r?$.getJSON(r,function(n){return 1===n.respuesta.res?i("rmdir",e[1],n.respuesta.mensaje):p()}).error(function(){throw"Server script doesn't exist."}):p()):(u("usage: rm directory"),p())},f.touch=function(e){var n,r;return void 0!==e[1]?(n=t(e[1]),r=v("touch",e[1]),r?$.getJSON(r,function(n){return 1===n.respuesta.res?i("touch",e[1],n.respuesta.mensaje):p()}).error(function(){throw"Server script doesn't exist."}):p()):(u("usage: touch fileName"),p())},Plugin=function(e,t){return this.element=e,this.conf=$.extend({},n,t.conf),this.shell=$.extend({},f,t.shell),this.env=$.extend({},r,t.env),this.help=$.extend({},o,t.help),this.historial=[],this.init()},Plugin.prototype={init:function(){return function(e){var n,t;return n=document.getElementsByTagName("script")[0],document.getElementById(e)?void 0:(t=document.createElement("script"),t.id=e,t.src="lib/md5.min.js",n.parentNode.insertBefore(t,n))}("md5"),this._showTerm(),this.lang(),this.enLaBusquedaDelTextoPerdido(),this._fill(!0),this.console()},_showTerm:function(){return $(this.element).delay(333).animate({opacity:1},1111)},_hideTerm:function(e){return $(this.element).delay(333).animate({opacity:0},1111,e)},enLaBusquedaDelTextoPerdido:function(){return 0===$(this.element).text().length?$(this.element).append('<div class="consola"></div>').find(".consola").append('<div class="consola-line"><span id="t"></span><span id="g"></span><span id="l">_</span></div>').find("span#t").text("sh-3.2# "+r.PWD+" "+r.USER+"$ "):void 0},lang:function(){var e,n,t;return e=["es-es","en-gb","en-us"],n=window.navigator.language,t=!1,$.each(e,function(e,r){return!t&&r.match(n)?(t=!0,n=r):void 0}),t||(n="en-gb"),$.getJSON("lib/lang/"+n+".json",function(e){return $.webterminal.idioma=e,Plugin.prototype.lang=e})},console:function(){return _this=this,$(document).keypress(function(n){var t,r;if(r=n.which,l=$(_this.element).find(".consola-line").length,a=$(".consola-line")[l-1],!(n.metaKey||n.ctrlKey&&82===r||n.ctrlKey&&84===r)){if(n.preventDefault(),_this._fill(!1),0===$(".consola").length&&$(_this.element).append('<div class="consola"></div>').find("span#l").remove(),0===l)$(".consola").append('<div class="consola-line"><span id="t"></span><span id="g"></span><span id="l">_</span></div>').find("span#t").text("sh-3.2# "+_this.env.PWD+" "+_this.env.USER+"$ ");else if(void 0!==String.fromCharCode(r)&&8!==r&&13!==r&&0!==r)e(String.fromCharCode(r));else if(8===r)h();else if(13===r)if($(a).find("span#l").remove(),$(a).append("<br>"),t=$(a).find("span#g").text().split(" "),_this.historial[_this.historial.length]=$(a).find("span#g").text(),$.each(t,function(e,n){var r,i,s,o,a;if(-1!==n.search("$")){for(o=n.split("$").length-1,r=0,a=[];o>r;)s=n.split("$")[1],i=_this.env[s],t[e]=i?i:"",a.push(r++);return a}}),void 0!==_this.shell[t[0]]&&void 0!==t[0])try{_this.shell[t[0]](t)}catch(i){throw n=i,u('<span style="color:red">&gt;&nbsp;Has ocurred an error. See dev tools console</span>'),p(),n}else void 0===_this.shell[t[0]]&&void 0!==t[0]&&_this.shell.none(t);return $(_this.element).scrollTop(1e5),$(_this.element).height()<$(".consola").height()?$(".consola-line").addClass("consola-line-short"):void 0}}).keydown(function(n){var t,r,i;return r=n.which,l=$(_this.element).find(".consola-line").length,a=$(".consola-line")[l-1],38===r?(n.preventDefault(),void 0===$(a).find("span#g").data("historial")?($(a).find("span#g").empty().data("historial",_this.historial.length-1),t=_this.historial[_this.historial.length-1],e(t)):(i=parseInt($(a).find("span#g").data("historial"))-1,t=_this.historial[i],i<=_this.historial.length&&i>=0&&($(a).find("span#g").empty().data("historial",i),e(t)))):40===r&&(n.preventDefault(),void 0===$(a).find("span#g").data("historial")?($(a).find("span#g").empty().data("historial",_this.historial.length+1),t=_this.historial[_this.historial.length+1]):(i=parseInt($(a).find("span#g").data("historial"))+1,t=_this.historial[i],i<=_this.historial.length&&i>=0&&($(a).find("span#g").empty().data("historial",i),e(t)))),$(_this.element).scrollTop(1e5),$(_this.element).height()<$(".consola").height()?$(".consola-line").addClass("consola-line-short"):void 0})},_fill:function(e){return e===!0&&($[d].shell=this.shell,$[d].print=u,$[d].help=this.help,$[d].newLine=p,$[d].urlHelper=v,$[d].dirHelper=t,$[d].conf=this.conf),$[d].env=this.env}},$.fn[d]=function(e){var n;return n=arguments,void 0===e||"object"==typeof e?this.each(function(){return $.data(this,"plugin_"+d)?void 0:$.data(this,"plugin_"+d,new Plugin(this,void 0===e?{}:e))}):void 0},$[d]=function(e){return $(".console").webterminal(e.element,e)},_this=Plugin.prototype,$[d].env=_this.env,$[d].shell=_this.shell,$[d].print=u,$[d].help=_this.help,$[d].conf=_this.conf,$[d].newLine=p,$[d].urlHelper=v,$[d].dirHelper=t,$[d].errorFormat=i}.call(this);