!function(){"use strict";var $,Plugin,e,n,t,r,i,s,a,o,l,u,c,p,d,h,f,v,window,_this;window=this,$=window.$,v="0.2-beta",c="webterminal",_this={},n={server:!1,script:void 0,phpscript:"/",width:484,height:314},r={TERM_PROGRAM:window.navigator.userAgent,PWD:decodeURI(document.location.pathname.substr(0,document.location.pathname.lastIndexOf("/")+1)),SHELL:decodeURI(document.location.pathname.substr(0,document.location.pathname.lastIndexOf("/")+1))+"webterminal.js",USER:"guest",VERSION:v},o={},h={},e=function(e){return $(a()).find("span#g").append(e)},p=function(e){return $(a()).find("span#g").append("<br>"+e)},a=function(){var e,n;return n=$(".consola .consola-line").length,e=$(".consola-line")[n-1]},d=function(){var e,n;return e=$(a()).find("span#g"),n=e.text().substr(0,e.text().length-1),e.empty().append(n)},l=function(){var e;return e=$(_this.element).find(".consola-line").length,$(".consola").append('<div class="consola-line" style="width: '+_this.width+'px"><span id="t"></span><span id="g"></span><span id="l">_</span></div>'),$($(".consola .consola-line")[e]).find("span#t").text("sh-3.2# "+_this.env.PWD+" "+_this.env.USER+"$ "),$(_this.element).scrollTop(1e5)},f=function(e){var t,r,i,s,a;if(n=_this.conf,n.server===!0){if("node.js"===n.script)i="http://"+document.location.hostname+":8080/",i=i+e+"/"+"?USER="+_this.env.USER;else{if("php"!==n.script)throw $.webterminal.idioma.scriptError;i="http://"+document.location.hostname+n.phpscript+"server.php?c="+e+"&USER="+_this.env.USER}for(r=0,s=0,a=arguments.length;a>s;s++)t=arguments[s],0!==s&&(i+="&"+(s-1)+"="+encodeURI(arguments[s]),r++);return i+="&PWD="+encodeURI(_this.env.PWD+"&argc="+r)}},t=function(e){var n,t;return-1!==e.indexOf("..")?(t=_this.env.PWD.split("/"),n="",$.each(t,function(e,r){return e<t.length-2?n+=r+"/":void 0}),-1!==e.indexOf("../")&&(n=e.replace("../",n))):"."===e||"./"===e?(n=_this.env.PWD,-1!==e.indexOf("./")&&(n=e.replace("./",n))):n=e,n},i=function(e,n,t){return p(""+e+": "+n+": "+t),l()},s=function(e,n,t){return p(""+e+": "+n+": "+t)},(u=function(){return 0===$("span#l").length&&$("body").append('<span id="l" style="display:none"></span>'),$("span#l").delay(600).animate({opacity:0},10).delay(600).animate({opacity:1},10,u)})(),h.cat=function(e){var n,r;return void 0!==e[1]&&void 0===e[2]?(n=encodeURI(t(e[1])),r=f("cat",n),r?$.getJSON(r,function(n){return 1!==n.respuesta.res?(p('<div style="text-align:left;">'+n.respuesta.mensaje+"</div>"),l()):i("cat",e[1],n.respuesta.mensaje)}).error(function(){throw"Server script doesn't exist."}):l()):void 0===e[1]||void 0===e[2]?(p("usage: cat file"),l()):e[1].indexOf(!1)?"-n"===e[1]?(n=encodeURI(t(e[2])),r=f("cat",n),$.getJSON(r,function(n){var t,r;return 1!==n.respuesta.res?(r=n.respuesta.mensaje.split("<br>"),t="",$.each(r,function(e,n){return 9>e?t=t+"&nbsp;&nbsp;&nbsp;&nbsp;"+(e+1)+" "+n+"<br>":99>e?t=t+"&nbsp;&nbsp;&nbsp;"+(e+1)+" "+n+"<br>":999>e?t=t+"&nbsp;&nbsp;"+(e+1)+" "+n+"<br>":9999>e?t=t+"&nbsp;"+(e+1)+" "+n+"<br>":void 0}),p('<div style="text-align:left;">'+t+"</div>"),l()):i("cat",e[2],n.respuesta.mensaje)}).error(function(){throw"Server script doesn't exist."})):"-b"===e[1]?(n=encodeURI(t(e[2])),r=f("cat",n),$.getJSON(r,function(n){var t,r,s,a;if(1!==n.respuesta.res){for(a=n.respuesta.mensaje.split("<br>"),s="",t=0,r=0,r=0;r<a.length;r++){var o=a[r];""!=o?(9>t?s=s+"&nbsp;&nbsp;&nbsp;&nbsp;"+(t+1)+" "+o+"<br>":99>t?s=s+"&nbsp;&nbsp;&nbsp;"+(t+1)+" "+o+"<br>":999>t?s=s+"&nbsp;&nbsp;"+(t+1)+" "+o+"<br>":9999>t&&(s=s+"&nbsp;"+(t+1)+" "+o+"<br>"),t++):s+="<br>"}return p('<div style="text-align:left;">'+s+"</div>"),l()}return i("cat",e[1],n.respuesta.mensaje)}).error(function(){throw"Server script doesn't exist."})):void 0:(p("usage: cat [-n] file"),l())},h.cd=function(e){var n,r;return void 0!==e[1]?(n=t(e[1]),r=f("cd",n),r?$.getJSON(r,function(n){return 1===n.respuesta.res?i("cd",e[1],n.respuesta.mensaje):(_this.env.PWD=n.respuesta.mensaje,l())}).error(function(){throw"Server script doesn't exist."}):l()):l()},h.cwd=function(){return p(_this.env.PWD),l()},h.echo=function(e){var n;return n="",$.each(e,function(e,t){return 0!==e?n+=" "+t:void 0}),p(n),l()},h.env=function(){return $.each(_this.env,function(e,n){return p(e+"="+n)}),l()},h["export"]=function(e){var n;return void 0!==e[1]?(n=e[1].split("="),_this.env[n[0]]=n[1],p(n[0]+" = "+n[1])):p("usage: export VARIABLE=VALUE"),l()},h.help=function(e){var n;return void 0===e[1]?(p("webterminal, version "+v+" ("+window.navigator.userAgent+")"),p($.webterminal.idioma.shell.help[1]),p($.webterminal.idioma.shell.help[2]),p($.webterminal.idioma.shell.help[3]),$.each(_this.lang.help,function(e,n){for(;e.length<7;)e+=" ";return p("&nbsp;&nbsp;"+e.replace(/\ /g,"&nbsp;")+" "+n[0])})):e[1]&&void 0!==_this.help[e[1]]?(n=_this.help[e[1]],p(e[1]+": "+n[0]),n[1]&&p(n[1])):e[1]&&void 0!==_this.lang.help[e[1]]?(n=_this.lang.help[e[1]],p(e[1]+": "+n[0]),n[1]&&p(n[1].replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"))):void 0===_this.help[e[1]]&&void 0===_this.lang.help[e[1]]&&p($.webterminal.idioma.shell.help.noHelp+" `"+e[1]+"`."),l()},h.login=function(e){var n;return void 0===e[1]?(p("No user/password given"),p("Usage: login USER [PASSWORD]"),l()):(n=f("login",e[1])+"&password="+(void 0!==e[2]?MD5(e[2]):"null"))?$.getJSON(n,function(e){return 1===e.respuesta.res?p(e.respuesta.mensaje):_this.env.USER=e.respuesta.mensaje,l()}):void 0},h.ls=function(e){var n;return e[1]&&-1!==e[1].search("-")?(s("ls",e[1],"illegal option"),p("usage: ls [directory ...]"),l()):2===e.length||1===e.length?(n=f("ls",e[1]?_this.env.PWD+e[1]:_this.env.PWD),n?$.getJSON(n,function(n){return 0===n.respuesta.res?($.each(n.respuesta.mensaje,function(e,n){return p(n)}),l()):i("ls",e[1],n.respuesta.mensaje)}).error(function(){throw"Server script doesn't exist."}):l()):($.each(e,function(t,r){return t?(n=f("ls",_this.env.PWD+r),n?$.getJSON(n,function(n){return 0!==n.respuesta.res?(s("ls",e[1],n.respuesta.mensaje),p("")):(p(r+":"),$.each(n.respuesta.mensaje,function(e,n){return p(n)}),t+1!==e.length?p(""):void 0)}).error(function(){throw"Server script doesn't exist."}):p("")):void 0}),l())},h.mkdir=function(e){var n,r;return void 0!==e[1]?(n=t(e[1]),r=f("mkdir",e[1]),r?$.getJSON(r,function(n){return 1===n.respuesta.res?i("mkdir",e[1],n.respuesta.mensaje):l()}).error(function(){throw"Server script doesn't exist."}):l()):(p("usage: mkdir directoryName"),l())},h.none=function(e){return""!==e[0]?(p("-bash: "+e[0]+": "+$.webterminal.idioma.shell.none),l()):void 0},h.printf=function(e){var n,t,r,s;if(t=function(e,n){var t;switch(e.charAt(0)){case"d":case"i":return t=Number(n),Number(t.toFixed())===t?t+e.substr(1):(i("printf","'"+n+"'","invalid number"),void 0);case"o":return void 0;case"u":return void 0;case"X":case"x":return void 0;case"f":case"F":return void 0;case"e":case"E":return void 0;case"g":case"G":return void 0;case"h":case"H":return void 0;case"c":return n.charAt(0+e.substr(1));case"s":return n+e.substr(1);case"b":return void 0;case"%":return e.substr(1);default:return i("printf","'"+e.charAt(0)+"'","invalid format character"),void 0}},e[1]){s=e[1].split("%"),r="",n=1;for(var a=0;a<s.length;a++){var o=s[a],u="";if(0!==a||o?0!==a&&o?(u=t(o,e[1+n]),n++):u=o:(u=t(s[a+1],e[1+n]),a++,n++),!u)return;r+=u}return p(r),l()}return i("printf","usage","printf [-v var] format [arguments ...]")},h.reload=function(){return $(_this.element).delay(333).animate({opacity:0},1111,function(){return window.location=window.location}),p('Waitâ€¦<span id="l">_</span>')},h.rm=function(e){var n,r;return void 0!==e[1]?(n=t(e[1]),r=f("rm",n),r?$.getJSON(r,function(n){return 1===n.respuesta.res?i("rm",e[1],n.respuesta.mensaje):l()}).error(function(){throw"Server script doesn't exist."}):l()):(p("usage: rm file"),l())},h.rmdir=function(e){var n,r;return void 0!==e[1]?(n=t(e[1]),r=f("rmdir",n),"-r"===e[2]&&(r+="&recursive"),r?$.getJSON(r,function(n){return 1===n.respuesta.res?i("rmdir",e[1],n.respuesta.mensaje):l()}).error(function(){throw"Server script doesn't exist."}):l()):(p("usage: rm directory"),l())},h.touch=function(e){var n,r;return void 0!==e[1]?(n=t(e[1]),r=f("touch",e[1]),r?$.getJSON(r,function(n){return 1===n.respuesta.res?i("touch",e[1],n.respuesta.mensaje):l()}).error(function(){throw"Server script doesn't exist."}):l()):(p("usage: touch fileName"),l())},Plugin=function(e,t){return this.element=e,this.conf=$.extend({},n,t.conf),this.shell=$.extend({},h,t.shell),this.env=$.extend({},r,t.env),this.help=$.extend({},o,t.help),this.historial=[],this.init()},Plugin.prototype={init:function(){return function(e){var n,t;return n=document.getElementsByTagName("script")[0],document.getElementById(e)?void 0:(t=document.createElement("script"),t.id=e,t.src="lib/md5.min.js",n.parentNode.insertBefore(t,n))}("md5"),this._showTerm(),this.lang(),this.enLaBusquedaDelTextoPerdido(),this._fill(!0),this.console()},_showTerm:function(){return $(this.element).delay(333).animate({opacity:1},1111)},_hideTerm:function(e){return $(this.element).delay(333).animate({opacity:0},1111,e)},enLaBusquedaDelTextoPerdido:function(){return this.width=this.conf.width-13,this.height=this.conf.height,$(this.element).css({"text-align":"justify","overflow-y":"auto",width:this.width+13+"px",height:this.height+"px"}),0===$(this.element).text().length?$(this.element).append('<div class="consola"></div>').find(".consola").append('<div class="consola-line" style="width:'+this.width+'px"><span id="t"></span><span id="g"></span><span id="l">_</span></div>').find("span#t").text("sh-3.2# "+r.PWD+" "+r.USER+"$ "):void 0},lang:function(){var e,n,t;return e=["es-es","en-gb","en-us"],n=window.navigator.language,t=!1,$.each(e,function(e,r){return!t&&r.match(n)?(t=!0,n=r):void 0}),t||(n="en-gb"),$.getJSON("lib/lang/"+n+".json",function(e){return $.webterminal.idioma=e,Plugin.prototype.lang=e})},console:function(){return _this=this,$(document).keypress(function(n){var t,r,i,s,a,o;if(i=n.which,a=$(_this.element).find(".consola-line").length,s=$(".consola-line")[a-1],!(n.metaKey||n.ctrlKey&&82===i||n.ctrlKey&&84===i)){if(n.preventDefault(),_this._fill(!1),0===$(".consola").length&&$(_this.element).append('<div class="consola"></div>').find("span#l").remove(),0===a)$(".consola").append('<div class="consola-line" style="width: '+_this.width+'px"><span id="t"></span><span id="g"></span><span id="l">_</span></div>').find("span#t").text("sh-3.2# "+_this.env.PWD+" "+_this.env.USER+"$ ");else if(void 0!==String.fromCharCode(i)&&8!==i&&13!==i&&0!==i)e(String.fromCharCode(i));else if(8===i)d();else if(13===i)if($(s).find("span#l").remove(),$(s).append("<br>"),t=$(s).find("span#g").text().split(" "),_this.historial[_this.historial.length]=$(s).find("span#g").text(),$.each(t,function(e,n){var r,i,s,a,o;if(-1!==n.search("$")){for(a=n.split("$").length-1,r=0,o=[];a>r;)s=n.split("$")[1],i=_this.env[s],t[e]=i?i:"",o.push(r++);return o}}),r=[],o="",$.each(t,function(e,n){return-1!==n.search('"')||-1!==n.search("'")?o?(o+=" "+n.substr(0,n.length-1),r.push(o),o=""):o||0!==n.lastIndexOf('"')&&0!==n.lastIndexOf("'")?r.push(n.substr(1,n.length-2)):o+=n.substr(1):o?o?o+=" "+n:void 0:r.push(n)}),t=r,void 0!==_this.shell[t[0]]&&void 0!==t[0])try{_this.shell[t[0]](t)}catch(u){throw n=u,p('<span style="color:red">&gt;&nbsp;Has ocurred an error. See dev tools console</span>'),l(),n}else void 0===_this.shell[t[0]]&&void 0!==t[0]&&_this.shell.none(t);return $(_this.element).scrollTop(1e5)}}).keydown(function(n){var t,r,i,s,a;return r=n.which,s=$(_this.element).find(".consola-line").length,i=$(".consola-line")[s-1],38===r?(n.preventDefault(),void 0===$(i).find("span#g").data("historial")?($(i).find("span#g").empty().data("historial",_this.historial.length-1),t=_this.historial[_this.historial.length-1],e(t)):(a=parseInt($(i).find("span#g").data("historial"))-1,t=_this.historial[a],a<=_this.historial.length&&a>=0&&($(i).find("span#g").empty().data("historial",a),e(t)))):40===r&&(n.preventDefault(),void 0===$(i).find("span#g").data("historial")?($(i).find("span#g").empty().data("historial",_this.historial.length+1),t=_this.historial[_this.historial.length+1]):(a=parseInt($(i).find("span#g").data("historial"))+1,t=_this.historial[a],a<=_this.historial.length&&a>=0&&($(i).find("span#g").empty().data("historial",a),e(t)))),$(_this.element).scrollTop(1e5),$(_this.element).height()<$(".consola").height()?$(".consola-line").addClass("consola-line-short"):void 0})},_fill:function(e){return e===!0&&($[c].shell=this.shell,$[c].print=p,$[c].help=this.help,$[c].newLine=l,$[c].urlHelper=f,$[c].dirHelper=t,$[c].conf=this.conf),$[c].env=this.env}},$.fn[c]=function(e){var n;return n=arguments,void 0===e||"object"==typeof e?this.each(function(){return $.data(this,"plugin_"+c)?void 0:$.data(this,"plugin_"+c,new Plugin(this,void 0===e?{}:e))}):void 0},$[c]=function(e){return $(".console").webterminal(e.element,e)},_this=Plugin.prototype,$[c].env=_this.env,$[c].shell=_this.shell,$[c].print=p,$[c].help=_this.help,$[c].conf=_this.conf,$[c].newLine=l,$[c].urlHelper=f,$[c].dirHelper=t,$[c].errorFormat=i}.call(this);